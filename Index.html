<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ANMOL SPECIAL MARIO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body{
  margin:0;
  overflow:hidden;
  background:#6ec6ff;
}
canvas{
  display:block;
  background:linear-gradient(#6ec6ff,#b3e5fc);
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ===== MOBILE FULL SIZE ===== */
function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

/* ===== STORAGE ===== */
let highScore = localStorage.getItem("highScore") || 0;

/* ===== GAME STATE ===== */
let gameStarted=false, gameOver=false;
let score=0, cameraX=0;

/* ===== PLAYER ===== */
const player={
  x:120, y:0,
  w:40, h:50,
  dx:3.4, dy:0,
  gravity:0.9,
  jump:-15,
  grounded:false
};

/* ===== GROUND ===== */
let grounds=[], nextGroundX=0;
const GAP_MIN=80, GAP_MAX=130;

function groundY(){
  return canvas.height - 90;
}

function createGround(x){
  return{
    x:x,
    y:groundY(),
    w:Math.random()*220+240,
    h:90
  };
}

function initGround(){
  grounds=[]; nextGroundX=0;
  for(let i=0;i<6;i++){
    let g=createGround(nextGroundX);
    grounds.push(g);
    nextGroundX+=g.w+(Math.random()*(GAP_MAX-GAP_MIN)+GAP_MIN);
  }
}

/* ===== AIR RECTANGLE PLATFORMS ===== */
let blocks=[], nextBlockX=360;

function blockY(){
  return groundY() - 120;   // ðŸ‘ˆ FIXED GAP
}

function createBlock(x){
  return{
    x:x,
    y:blockY(),
    w:canvas.width*0.35,
    h:28
  };
}

function initBlocks(){
  blocks=[]; nextBlockX=360;
  for(let i=0;i<4;i++){
    blocks.push(createBlock(nextBlockX));
    nextBlockX+=canvas.width*0.7;
  }
}

/* ===== BUTTON ===== */
const btn={
  w:220, h:52,
  get x(){return canvas.width/2-this.w/2},
  get y(){return canvas.height/2+40}
};

/* ===== RESET ===== */
function resetGame(){
  if(score>highScore){
    highScore=score;
    localStorage.setItem("highScore",highScore);
  }

  gameStarted=false;
  gameOver=false;
  score=0;
  cameraX=0;

  player.x=120;
  player.y=groundY()-player.h;   // ðŸ‘ˆ START ON GROUND
  player.dy=0;
  player.grounded=true;

  initGround();
  initBlocks();
}

/* ===== TOUCH CONTROL ===== */
function tap(e){
  const r=canvas.getBoundingClientRect();
  const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left;
  const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top;

  if(!gameStarted){
    if(x>btn.x&&x<btn.x+btn.w&&y>btn.y&&y<btn.y+btn.h){
      gameStarted=true;
    }
    return;
  }

  if(gameOver){
    if(x>btn.x&&x<btn.x+btn.w&&y>btn.y&&y<btn.y+btn.h){
      resetGame();
    }
    return;
  }

  // TAP ANYWHERE TO JUMP
  if(player.grounded){
    player.dy=player.jump;
    player.grounded=false;
  }
}

canvas.addEventListener("touchstart",tap);
canvas.addEventListener("click",tap);

/* ===== UPDATE ===== */
function update(){
  if(!gameStarted||gameOver) return;

  player.x+=player.dx;
  cameraX+=player.dx;
  score++;

  player.dy+=player.gravity;
  player.y+=player.dy;
  player.grounded=false;

  // Ground collision
  grounds.forEach(g=>{
    const okX=player.x+player.w>g.x+4&&player.x<g.x+g.w-4;
    const land=player.y+player.h<=g.y+14 &&
               player.y+player.h+player.dy>=g.y;
    if(okX&&land&&player.dy>=0){
      player.y=g.y-player.h;
      player.dy=0;
      player.grounded=true;
    }
  });

  // Air platform collision
  blocks.forEach(b=>{
    const landTop=
      player.dy>=0 &&
      player.y+player.h<=b.y+12 &&
      player.y+player.h+player.dy>=b.y &&
      player.x+player.w>b.x+6 &&
      player.x<b.x+b.w-6;

    if(landTop){
      player.y=b.y-player.h;
      player.dy=0;
      player.grounded=true;
    }

    const sideHit=
      player.x+player.w>b.x &&
      player.x<b.x+b.w &&
      player.y+player.h>b.y+6 &&
      player.y<b.y+b.h-6 &&
      !landTop;

    if(sideHit){
      gameOver=true;
    }
  });

  // recycle ground
  if(grounds[0].x+grounds[0].w<cameraX){
    grounds.shift();
    let g=createGround(nextGroundX);
    grounds.push(g);
    nextGroundX+=g.w+(Math.random()*(GAP_MAX-GAP_MIN)+GAP_MIN);
  }

  // recycle blocks
  if(blocks[0].x+blocks[0].w<cameraX){
    blocks.shift();
    blocks.push(createBlock(nextBlockX));
    nextBlockX+=canvas.width*0.7;
  }

  // fall
  if(player.y>canvas.height+80){
    gameOver=true;
  }
}

/* ===== DRAW ===== */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ground
  ctx.fillStyle="#2e7d32";
  grounds.forEach(g=>{
    ctx.fillRect(g.x-cameraX,g.y,g.w,g.h);
  });

  // air platforms
  ctx.fillStyle="#ffca28";
  blocks.forEach(b=>{
    ctx.fillRect(b.x-cameraX,b.y,b.w,b.h);
  });

  // player
  ctx.fillStyle="#e53935";
  ctx.fillRect(player.x-cameraX,player.y,player.w,player.h);

  // score
  ctx.fillStyle="#000";
  ctx.font="18px Arial";
  ctx.fillText("Score: "+score,20,30);
  ctx.fillText("High: "+highScore,20,55);

  // overlays
  if(!gameStarted||gameOver){
    ctx.fillStyle="rgba(0,0,0,0.7)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    if(gameOver){
      ctx.save();
      ctx.textAlign="center";
      ctx.font="bold 32px Arial";
      ctx.shadowColor="yellow";
      ctx.shadowBlur=18;
      ctx.fillStyle="#ffeb3b";
      ctx.fillText("ANMOL MERA BAAP HAI",canvas.width/2,canvas.height/2-20);
      ctx.restore();
    }

    ctx.fillStyle="#d32f2f";
    ctx.fillRect(btn.x,btn.y,btn.w,btn.h);
    ctx.fillStyle="#fff";
    ctx.textAlign="center";
    ctx.font="20px Arial";
    ctx.fillText(gameOver?"RESTART":"START",btn.x+btn.w/2,btn.y+34);
    ctx.textAlign="left";
  }
}

/* ===== LOOP ===== */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

resetGame();
loop();
</script>
</body>
</html>
